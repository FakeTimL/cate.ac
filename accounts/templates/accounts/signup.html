{% extends "base.html" %}
{% load i18n %}

{% block title %}{{ page_title }}{% endblock %}

{% block content %}
<div class="section" id="vue_app_content">
  {% if redirect %}<p>{% trans "Please log in to see this page." %}</p>{% endif %}
  <p v-if="error_message"><strong>[[ error_message ]]</strong></p>
  
  <form class="ui form" method="post" action="{% url 'accounts:signup' %}" v-on:submit="submitCheck">
    {% csrf_token %}
    <div class="field">
      <label>{% trans 'Username' %}</label>
      <input type="text" name="username" v-model="username" placeholder="{% trans 'Username' %}" />
    </div>
    <div class="field">
      <label>{% trans 'Email' %}{% trans ' (optional)' %}</label>
      <input type="text" name="email" v-model="email" placeholder="{% trans 'Email' %}{% trans ' (optional)' %}" />
    </div>
    <div class="field">
      <label>{% trans 'Password' %}</label>
      <input type="password" name="password" v-model="password" placeholder="{% trans 'Password' %}" />
    </div>
    <div class="field">
      <label>{% trans 'Repeat Password' %}</label>
      <input type="password" v-model="password_repeat" placeholder="{% trans 'Repeat Password' %}" />
    </div>
    <div class="inline field">
      <div class="ui checkbox">
        <input id="agree_to_terms" type="checkbox" tabindex="0" />
        <label for="agree_to_terms">{% trans "I agree to the " %}<a href="{% url 'main:terms_of_use' %}">{% trans "Terms of Use" %}</a>{% trans " and " %}<a href="{% url 'main:privacy_policy' %}">{% trans "Privacy Policy" %}</a></label>
      </div>
    </div>
    <!-- <p><img src="..." class="image" id="captchaImage" /></p> -->
    <!-- <p><input type="text" name="captcha" placeholder="{% trans 'Captcha (case insensitive)' %}" /></p> -->
    <a class="ui button" href="{% url 'accounts:index' %}">{% trans "Go back" %}</a>
    <input class="ui button primary" type="submit" value="{% trans 'Sign up' %}" />
    <input type="hidden" name="redirect" value="{{ redirect }}" />
  </form>
  
  <p><a href="{% url 'accounts:login' %}{% if redirect %}?redirect={{ redirect }}{% endif %}">{% trans "Already have an account?" %}</a></p>
</div>

<script>
var vm = new Vue({
  delimiters: ['[[', ']]'],
  el: '#vue_app_content',
  data: {
    username: '',
    email: '',
    password: '',
    password_repeat: '',
    error_message: '{% if error_message %}{{ error_message }}{% endif %}',
  },
  methods: {
    submitCheck: function(e) {
      if (this.username == '') {
        e.preventDefault();
        this.error_message = '{% trans "Username must not be empty." %}'
        return false;
      }
      if (this.password != this.password_repeat) {
        e.preventDefault();
        this.error_message = '{% trans "Two passwords are different." %}'
        return false;
      }
      return true;
    }
  }
})
</script>
{% endblock %}
